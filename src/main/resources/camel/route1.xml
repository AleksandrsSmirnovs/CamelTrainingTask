<?xml version="1.0" encoding="UTF-8"?>

<route id="route1" xmlns="http://camel.apache.org/schema/spring">
    <from uri="file:src/in?noop=true"/>
    <log message="Processing file: ${header.CamelFileName}"/>
    <split streaming="true">
        <tokenize token="\n"/>
                <choice>
                    <when>
                        <simple>${exchangeProperty.CamelSplitIndex} > 0</simple>
                        <unmarshal>
                            <bindy type="Csv" classType="task.training.cameltraining.model.OrderCsvRecord"/>
                        </unmarshal>
                        <log message="${body}"/>
                        <to uri="direct:foo"/>
                    </when>
                    <otherwise>
                        <stop/>
                    </otherwise>
                </choice>
    </split>
    <log message="Done processing file: ${header.CamelFileName}"/>
</route>